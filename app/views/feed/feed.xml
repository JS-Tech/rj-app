<Page loaded="loaded"
  xmlns:navbar="views/components/navbar"
  xmlns:lv="nativescript-telerik-ui/listview"
  xmlns:post="views/components/post">

  <Page.actionBar>
      <ActionBar title="Feed">
        <Image src="res://logorjpr" width="40px"/>
        <ActionItem visibility="{{ isAdmin ? 'visible' : 'collapse' }}" tap="newPost" ios.systemIcon="7" ios.position="right" android.systemIcon="ic_menu_add" android.position="actionBar"/>
      </ActionBar>
  </Page.actionBar>

  <GridLayout columns="*" rows="*, 60" class="main">
      <GridLayout rows="auto, *" class="list">
        <lv:RadListView items="{{ posts }}" pullToRefresh="true" row="1" pullToRefreshInitiated="refresh" loadOnDemandMode="Auto" loadMoreDataRequested="loadMore">
          <lv:RadListView.listViewLayout>
            <lv:ListViewLinearLayout scrollDirection="Vertical"/>
          </lv:RadListView.listViewLayout>

          <!-- ##### Post ##### -->
          <lv:RadListView.itemTemplate>
            <StackLayout orientation="vertical" class="news">

              <!-- ##### Infos ##### -->
              <GridLayout rows="auto, *" columns="auto, *, auto, auto" class="infos">
                <Label text="&#xE0C9;" row="0" col="0" class="material-font info-icon"/>
                <Label text="{{ author }}" row="0" col="1" class="author"/>
                <Button text="&#xE150;" class="material-font action" row="0" col="2" tap="editPost" visibility="{{ canEdit ? 'visible' : 'collapse' }}"/>
                <Button text="&#xE15C;" class="material-font action" row="0" col="3" postId="{{ id }}" tap="deletePost" visibility="{{ canEdit ? 'visible' : 'collapse' }}"/>
              </GridLayout>
              <!-- ##### ##### -->

              <label text="{{'Posté le ' + createdAtDate + ' à ' + createdAtTime }}" row="1" col="1" class="date"></label>
              <TextView text="{{ message }}" editable="false" class="message" />
              <Image src="{{ imageUrl }}" />

              <!-- ##### Comment ##### -->
              <StackLayout visibility="{{ lastComment ? 'visible' : 'collapse' }}" orientation="vertical" class="last-comment">
                <label text="Dernier commentaire" class="last-comment"/>
                <label text="{{ lastComment.author }}" editable="false" class="last-comment-author" />
                <TextView text="{{ lastComment.message }}" editable="false" class="last-comment-message" />
              </StackLayout>
              <Label text="&#xE0B9;" postId="{{ id }}" tap="toPost" class="comments material-font" />
              <!-- ##### ##### -->
              
            </StackLayout>
          </lv:RadListView.itemTemplate>
          <!-- ##### ##### -->

        </lv:RadListView>
      </GridLayout>
      <navbar:navbar row="1" pageName="feed"/>
      <ActivityIndicator busy="{{ isLoading }}" row="0" width="50" />
  </GridLayout>
</Page>
